<%= admin_breadcrumb %>

<div class="row-fluid">
  <div class="span12">
      <h1 class="pull-left"><%= @parent.nil? ? 'Content Tree' : "Content under '#{@parent.title}'" %></h1>

      <div class="btn-group pull-right">
        <% if @parent.nil? -%>
          <% if Noodall::Node.root_templates.any? -%>
            <%= link_to '<i class="icon-plus"></i> New'.html_safe, new_noodall_admin_node_path, :class => 'btn btn-success', :title => "Add new" %>
          <% end -%>
        <% elsif @parent.class.template_names.any?  %>
          <%= link_to '<i class="icon-plus"></i> New'.html_safe, new_noodall_admin_node_node_path(@parent), :class => 'btn btn-success', :title =>  "Add content under #{@parent.title}" %>
        <% end -%>
        <% if !@parent.nil? and !@parent.parent.nil? %>
          <%= link_to "<i class='icon-chevron-up'></i> Up to #{@parent.parent.title}".html_safe, noodall_admin_node_nodes_path(@parent.parent), :class => "btn" %>
        <% end %>
        <% if !@parent.nil?  %>
          <%= link_to "<i class='icon-arrow-up'></i> Top Level".html_safe, noodall_admin_nodes_path, :class => "btn" %>
        <% end %>
      </div>
      
  </div> <!-- span12 -->
</div> <!-- row-fluid -->


<div class="row-fluid">
    <div class="span7 offset5 filter-by-title">
      <%= form_tag '', :method => :get, :id => 'filter', :class => "well form-inline pull-right" do %>
        <%= label_tag :f, 'Filter by Title' %>
        <%= text_field_tag :f %>
        <%= submit_tag "Filter", :class => "btn" %>
      <% end %>
      <% if params[:f] %>
        <%= link_to "reset", url_for(:only_path => false, :f => nil), :class => 'button' %>
      <% end %>
    </div>
</div>

<div class="row-fluid">
  <div class="span12">
    <%= will_paginate(@nodes, :previous_label => 'Previous', :next_label => 'Next') %>
     <table border="0" cellspacing="0" cellpadding="0" class="table table-bordered table-hover" id="content-table">
      <thead>
        <tr>
          <%= admin_nodes_column_headings %>
        </tr>
      </thead>
      <tbody>
    <% @nodes.each do |node| %>
        <tr id="node-<%= node.id %>" class="node">
          <td class="edit"><%= link_to "#{ node.admin_title } #{ '(draft)' if node.has_draft? }", noodall_admin_node_path(node), :class => 'edit', :title => "Edit #{node.title}" %></td>
          <td><%= node.class.name.titleize %></td>
          
          <%# Change 'position' content if we are sorting by position %>
          <% if(params[:sort] && params[:sort] != "position" || params[:order] == "descending") %>
            <td width="55"><%= node.position %></td>
          <% else %>
            <td class="move-up" width="25"><%= link_to('<i class="icon-arrow-up center up"></i>'.html_safe, move_up_noodall_admin_node_path(node), :class => 'page_up', :title => 'Move this content higher in the navigation') unless node.first? %></td>
            <td class="move-down" width="30"><%= link_to('<i class="icon-arrow-down down"></i>'.html_safe, move_down_noodall_admin_node_path(node), :class => 'page_down', :title => 'Move this content lower in the navigation') unless node.last? %></td>
            
          <% end %>
          
          <td class="child">
            <% unless node.class.template_classes.blank? -%>
              <%= link_to pluralize(node.children.size, "Child"), noodall_admin_node_nodes_path(node), :title => "View content under #{h(node.title)}", :class => 'child-no' %>
              <%= link_to('<i class="icon-plus pull-right add"></i>'.html_safe, new_noodall_admin_node_node_path(node), :title => "Add content under #{h(node.title)}", :class => 'child') if node.class.template_names.any? %>
            <% end -%>
          </td>
          
          <td class="date" title="by <%= updater_name(node) %>"><%=h node.updated_at.to_formatted_s(:noodall_time) %></td>
          <% if node.published? %>
          <td class="show"><%= link_to '<i class="icon-eye-open"></i>'.html_safe, node_path(node), :class => 'show', :title => 'View this content' if node.published? %></td>
          <% else %>
          <td class="show"><i class="icon-eye-close"></i></td>
          <% end %>
          
          <td class="publish" title="<%= node.published? ? 'Published ':'Hidden' %><%= node.published_at.to_formatted_s(:short_ordinal) unless node.published_at.nil? %><%= " - #{node.published_to.to_formatted_s(:noodall_time)}" unless node.published_to.nil? %>"><%= (node.published? ? '<i class="icon-ok"></i>' : '<i class="icon-file"></i>').html_safe %></td>
          <td class="delete"><%= link_to '<i class="icon-remove"></i>'.html_safe, noodall_admin_node_path(node), :confirm => 'Are you sure?', :method => :delete, :class => 'delete', :title => 'Delete this content' unless node.in_site_map? %></td>
        </tr>
    <% end %>
      </tbody>
      <tfoot>
        <tr>
          <%= admin_nodes_column_headings %>
        </tr>
      </tfoot>
    </table>
    <%= will_paginate(@nodes, :previous_label => 'Previous', :next_label => 'Next') %>
  </div>
</div>

  </div> <!-- span12 -->
</div> <!-- row-fluid -->